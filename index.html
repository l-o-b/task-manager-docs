<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Task Manager Service</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all_nosearch.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["javascript"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="task-manager-service">Task Manager Service</h1>

<p>Service provides the basic support for a multi-tasking pool of workers, their manager as well as the business users that are submitting tasks that need to be done.</p>

<h1 id="tasks">/tasks</h1>

<h2 id="post-tasks">POST /tasks</h2>
<pre class="highlight javascript"><code><span class="p">{</span> 
    <span class="nl">title</span> <span class="p">:</span> <span class="s1">'email me some positive thoughts. I am feeling down!'</span><span class="p">,</span>
      <span class="cm">/*title or short description of the task
      displayed prominently in task listings and such
      some listing display shorter portions if you put a long title
      expect to be shown in many places with ellipsis

      required */</span>
    <span class="nx">description</span> <span class="err">:</span>  <span class="s1">''</span><span class="p">,</span>
     <span class="cm">/* longer/full description of the task
      typically displayed when showing a single task

      optional 
      empty */</span>

    <span class="nx">deadline</span> <span class="err">:</span>  <span class="nx">date</span><span class="p">,</span>
      <span class="cm">/*deadline for the task
      datetime in whatever is the standard form an API

      optional  
      default to 24 hrs from submission time
      negative or 0 means asap and changes into now (plus + estimate)*/</span>

    <span class="nx">estimate</span> <span class="err">:</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1">//assuming that the units is "seconds"</span>
      <span class="cm">/*submitter expectation of time that it would take to finish the task
      in whatever is the standard unit for time apis

      optional
      default =&gt; 1 hr*/</span>

    <span class="nx">owner</span> <span class="err">:</span>  <span class="s2">"odysseas@ezhome.com"</span><span class="p">,</span>
      <span class="cm">/*who this task is for
      using email because it makes the API more easy to use..everyone has the email
      quite possibly internally the app should always be recording user-id  but allow
      incoming user references to be email based and outgoing user references are also 
      converted into the "user's current email" for api friendlyness

      optional
      default : the currently authenticated user*/</span>

    <span class="nx">tags</span> <span class="err">:</span> <span class="s1">'tag1 tag2'</span><span class="p">,</span>
     <span class="cm">/*string of tags separated by whitespace
      optional 
      tags are used as the catch-all instead of structured filtering (list-ing) for now*/</span>

    <span class="nx">state</span> <span class="err">:</span> <span class="s1">'current task state'</span>
     <span class="cm">/* one of these string values:
        'queued'
        'worked on'
        'deleted'
        'done'*/</span>
<span class="p">}</span>
</code></pre>

<p>In response the POST call returns the newly created object
which includes filled in defaulted empty attributes, (equiv to GET /tasks/5768)</p>

<p>The above should be support the use case of the add command.</p>

<h2 id="get-tasks-status-status-amp-owner-owner-amp-n-n">GET /tasks?status=status&amp;owner=owner&amp;n=N</h2>

<p>Returns list of N tasks with the given status and owner (status must be one of the following strings: &lsquo;queued/active/suspended/completed/deleted&rsquo;)</p>
<pre class="highlight javascript"><code><span class="p">[</span>
    <span class="p">{</span>
        <span class="na">description</span><span class="p">:</span> <span class="s1">'description string'</span><span class="p">,</span>
        <span class="na">deadline</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">estimate</span><span class="p">:</span> <span class="p">,</span>
        <span class="na">owner</span><span class="p">:</span> <span class="s1">'owner email'</span><span class="p">,</span>
        <span class="na">properties</span><span class="p">:</span> <span class="p">{</span><span class="na">key</span><span class="p">:</span> <span class="nx">value</span><span class="p">},</span>
        <span class="na">state</span><span class="p">:</span> <span class="s1">'queued/worked on/deleted/done'</span><span class="p">,</span>
        <span class="na">_id</span><span class="p">:</span> <span class="nx">task_id</span><span class="p">,</span>
        <span class="na">_created_by</span><span class="p">:</span> <span class="s1">'creator email'</span><span class="p">,</span>
        <span class="na">_created_on</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">_last_modified_on</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">_worked_by</span><span class="p">:</span> <span class="s1">'worker email'</span><span class="p">,</span>
        <span class="na">_worked_on</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">_work_status</span><span class="p">:</span> <span class="s1">'active/suspended/success/failure'</span><span class="p">,</span>
        <span class="na">_completed_on</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">_tags</span><span class="p">:</span> <span class="s1">'first_tag second_tag'</span>
    <span class="p">},</span>
    <span class="p">...</span>
<span class="p">]</span>
</code></pre>

<h2 id="tasks-task_id">/tasks/{task_id}</h2>

<h3 id="get-tasks-task_id">GET /tasks/{task_id}</h3>

<p>Returns task information</p>
<pre class="highlight javascript"><code><span class="p">{</span>   
  <span class="nl">title</span> <span class="p">:</span> <span class="s1">'email me some positive thoughts. I am feeling down!'</span>
  <span class="nl">description</span>  <span class="p">:</span>  
  <span class="nl">deadline</span>  <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span>
  <span class="nl">estimate</span> <span class="p">:</span> <span class="mi">300</span>
  <span class="nl">owner</span> <span class="p">:</span>  <span class="s1">'odysseas@ezhome.com'</span>
  <span class="nl">tags</span> <span class="p">:</span> <span class="p">[</span> <span class="nx">tag1</span> <span class="nx">tag2</span> <span class="p">]</span>

  <span class="cm">/* system attrs */</span>
  <span class="nl">_id</span> <span class="p">:</span> <span class="nx">task_id</span>
  <span class="nl">_created_by</span> <span class="p">:</span> <span class="s1">'odysseas@ezhome.com'</span>    
  <span class="nx">_created_on</span> <span class="err">:</span> <span class="s1">'2015-11-20T17:26:33Z'</span> 
  <span class="nx">_last_modified_on</span> <span class="err">:</span> <span class="s1">'2015-11-20T17:26:33Z'</span>
  <span class="nl">_state</span> <span class="p">:</span> <span class="s1">'queued'</span>
  <span class="nl">_worked_by</span> <span class="p">:</span> <span class="s1">'mary@ezhome.com'</span>            <span class="c1">// if the task is under the control of a worker which worker that is</span>
  <span class="nl">_worked_on</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:26:33Z'</span>       <span class="c1">// if the task is under the control of a worker .. when it was last grabbed */</span>
  <span class="nl">_work_status</span> <span class="p">:</span> <span class="nx">suspended</span> <span class="nx">or</span> <span class="nx">active</span>        <span class="c1">// if the task is under the control of a worker</span>
  <span class="nl">_completion_status</span> <span class="p">:</span> <span class="nx">success</span> <span class="nx">or</span> <span class="nx">failure</span>   <span class="c1">// if the test is completed</span>
  <span class="nl">_completed_on</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:26:33Z'</span>    <span class="c1">// if the test is completed</span>

<span class="p">}</span>
</code></pre>

<h3 id="put-tasks-task_id">PUT /tasks/{task_id}</h3>
<pre class="highlight javascript"><code><span class="p">{</span>   
  <span class="nl">_id</span> <span class="p">:</span> <span class="mi">5768</span>
  <span class="nl">title</span> <span class="p">:</span> <span class="s1">'email me some positive thoughts. I am feeling down!'</span>
  <span class="nl">description</span>  <span class="p">:</span>  
  <span class="nl">deadline</span>  <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span>
  <span class="nl">estimate</span> <span class="p">:</span> <span class="mi">300</span>
  <span class="nl">owner</span> <span class="p">:</span>  <span class="s1">'odysseas@ezhome.com'</span>

<span class="p">}</span>
</code></pre>

<p>=&gt; returns the updated object same as GET /tasks/5768</p>

<p>Updating an existing task
with PUT or whatever is the right convention for the update of an existing object</p>

<p>Given the minimal need for this I am trying to keep the implementation as simple as possible.</p>

<p>For simplicity, the complete object is being replaced,
ie, if a parameter is missing we do not keep existing values, we simply follow the same defaulting 
logic that we follow on <code class="prettyprint">add</code> to generate defaults for the missing parameters.
Also, note that for now we do not allow tag update (more complex will need tag add and tag remove functionality)</p>

<p>The only &ldquo;business logic&rdquo; is that we only allow a task to be updated if it is in <code class="prettyprint">queued</code> state.
Descriptive error messages are generated otherwise, e.g.
<code class="prettyprint">
Cannot Update. Task is  (being worked on|completed|deleted)
Task does not exist.
</code>
The above should be able to support the use case of update command</p>

<h3 id="delete-tasks-task_id">DELETE /tasks/{task_id}</h3>

<p>It sets the state to &ldquo;deleted&rdquo;  - which is considered a final state
Only queued tasks are allowed to be deleted</p>

<p><code class="prettyprint">returns the deleted object same as GET /tasks/5768
</code></p>

<p>Descriptive error messages are generated on error
<code class="prettyprint">
Cannot Delete. Task is  (being worked on|completed)
Task does not exist.
</code></p>

<h3 id="tasks-task_id-purge">/tasks/{task_id}/purge</h3>

<h4 id="post-tasks-task_id-purge">POST /tasks/{task_id}/purge</h4>

<p>Removes task and all events for this task from database</p>

<h3 id="tasks-task_id-history">/tasks/{task_id}/history</h3>

<h4 id="get-tasks-task_id-history">GET /tasks/{task_id}/history</h4>

<p>This command shows chronological history of events and some additional timing information for selected task</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="nl">events</span> <span class="p">:</span> <span class="p">[</span>         <span class="c1">// complete chronoligical history of events</span>
    <span class="p">{</span> <span class="na">when</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span><span class="p">,</span> <span class="na">who</span> <span class="p">:</span> <span class="s1">'joe@ezhome.com'</span><span class="p">,</span> <span class="na">what</span> <span class="p">:</span> <span class="s1">'grab'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">when</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span><span class="p">,</span> <span class="na">who</span> <span class="p">:</span> <span class="s1">'joe@ezhome.com'</span><span class="p">,</span> <span class="na">what</span> <span class="p">:</span> <span class="s1">'grab'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">when</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span><span class="p">,</span> <span class="na">who</span> <span class="p">:</span> <span class="s1">'joe@ezhome.com'</span><span class="p">,</span> <span class="na">what</span> <span class="p">:</span> <span class="s1">'grab'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">when</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span><span class="p">,</span> <span class="na">who</span> <span class="p">:</span> <span class="s1">'joe@ezhome.com'</span><span class="p">,</span> <span class="na">what</span> <span class="p">:</span> <span class="s1">'grab'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">when</span> <span class="p">:</span> <span class="s1">'2015-11-20T17:31:33Z'</span><span class="p">,</span> <span class="na">who</span> <span class="p">:</span> <span class="s1">'joe@ezhome.com'</span><span class="p">,</span> <span class="na">what</span> <span class="p">:</span> <span class="s1">'grab'</span> <span class="p">},</span>
  <span class="p">]</span>

  <span class="c1">// some aggregates on top of the history of the events</span>
  <span class="nx">time_elapsed</span>       <span class="c1">// time since first submitted</span>
  <span class="nx">time_til_deadline</span>
  <span class="nx">time_worked_on</span>     <span class="c1">//time the task has spent being the active task of the current worker (only if in-progress)</span>
  <span class="nx">time_suspended</span>     <span class="c1">// time the task has spent suspended by the current worker (only if in-progress)</span>
  <span class="nx">time_queued</span>        <span class="c1">// total time in the queue</span>
  <span class="nx">time_rejected</span>      <span class="c1">// total time under the control of users that eventually released the task without completing it</span>
  <span class="nx">times_rejected</span>     <span class="c1">// how many times the current task has been rejected by prior users</span>
<span class="p">}</span>
</code></pre>

<h2 id="tasks-queued">/tasks/queued</h2>

<h3 id="get-tasks-queued">GET /tasks/queued</h3>

<p>Returns a list of tasks, which state is &ldquo;queued&rdquo;. Maximum 100 tasks
<code class="prettyprint">
returns array in the same format as GET /tasks
</code></p>

<h2 id="tasks-available">/tasks/available</h2>

<h3 id="get-tasks-available-n-n">GET /tasks/available?n=N</h3>

<p>Returns a list of tasks ordered (1st most urgent ) up to N
if N missing returns just 1
In the simplest form it can return tasks based on order requested
<code class="prettyprint">
returns array in the the same format as GET /tasks
</code></p>

<h1 id="workers">/workers</h1>

<h2 id="post-workers">POST /workers</h2>

<p>Login current user<br/></p>
<pre class="highlight javascript"><code><span class="nx">request</span><span class="err">:</span>
<span class="p">{</span>
  <span class="nl">id</span> <span class="p">:</span> <span class="s1">'odysseas@ezhome.com'</span>
<span class="p">}</span>
<span class="nl">returns</span><span class="p">:</span>
<span class="k">if</span> <span class="nx">user</span> <span class="nx">tries</span> <span class="nx">to</span> <span class="nx">login</span> <span class="nx">from</span> <span class="nx">slack</span>
<span class="p">{</span>
    <span class="nl">text</span><span class="p">:</span> <span class="s1">'You are now logged in! You can start working.'</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="na">token</span><span class="p">:</span> <span class="nx">uuid</span>
<span class="p">}</span>
</code></pre>

<h2 id="get-workers">GET /workers</h2>

<p>Returns a list of users from the database</p>
<pre class="highlight javascript"><code><span class="p">[</span>
  <span class="p">{</span> 
    <span class="na">_id</span> <span class="p">:</span> <span class="mi">4567</span>  <span class="err">#</span> <span class="nx">a</span> <span class="nx">worker</span><span class="o">-</span><span class="nx">id</span>
    <span class="na">userid</span> <span class="p">:</span> <span class="nx">odysseas</span><span class="err">@</span><span class="nx">ezhome</span><span class="p">.</span><span class="nx">com</span>
    <span class="na">loggedin_on</span> <span class="p">:</span> <span class="nx">date</span>
    <span class="na">status</span><span class="p">:</span> <span class="s1">'loggedout/loggedin'</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</code></pre>

<h2 id="delete-workers">DELETE /workers</h2>

<p>Logs out current user</p>
<pre class="highlight plaintext"><code>if user is working from slack
{
    text: 'You have just logged out! See you again'
}
</code></pre>
<pre class="highlight plaintext"><code>else returns empty object
</code></pre>

<h2 id="workers-tasks">/workers/tasks</h2>

<h3 id="post-workers-tasks">POST /workers/tasks</h3>

<p>Loads user&rsquo;s tasks from database and sets the first task active (&ldquo;foreground&rdquo; state)
<code class="prettyprint">
returns fully filled task item
</code></p>

<h2 id="workers-tasks-task_id">/workers/tasks/{task_id}</h2>

<h3 id="post-workers-tasks-task_id">POST /workers/tasks/{task_id}</h3>

<p>Sets selected task active (&ldquo;foreground&rdquo; state). If selected task is not in queue then throws error message
<code class="prettyprint">
returns fully filled task item
</code></p>

<h3 id="put-workers-tasks-task_id">PUT /workers/tasks/{task_id}</h3>

<p>Updates task status
If selected status is &ldquo;fg&rdquo; then task becomes active
If status is &ldquo;bg&rdquo; then task becomes suspended
If status is &ldquo;release&rdquo; then task returns to the task queue without completing
If status is &ldquo;complete-success&rdquo; then task becomes successfully completed
If status is &ldquo;complete-failure&rdquo; then task becomes completed(but with failure)
<code class="prettyprint">
returns informational messages
</code></p>

<h2 id="workers-user_email">/workers/{user_email}</h2>

<h3 id="get-workers-user_email">GET /workers/{user_email}</h3>

<p>Loads user info from database and returns it</p>
<pre class="highlight javascript"><code><span class="p">{</span>
    <span class="nl">userid</span> <span class="p">:</span> <span class="s1">'mail@email.com'</span>
    <span class="nl">loggedin_on</span> <span class="p">:</span> <span class="nx">date</span>
    <span class="nl">status</span><span class="p">:</span> <span class="s1">'loggedout/loggedin'</span>
  <span class="p">}</span>
</code></pre>

<h2 id="workers-loggedin">/workers/loggedin</h2>

<h3 id="get-workers-loggedin">GET /workers/loggedin</h3>

<p>Returns array containing currently logged users</p>
<pre class="highlight javascript"><code><span class="p">[</span>
    <span class="p">{</span>
        <span class="na">userid</span> <span class="p">:</span> <span class="s1">'mail@email.com'</span>
        <span class="na">loggedin_on</span> <span class="p">:</span> <span class="nx">date</span>
        <span class="na">status</span><span class="p">:</span> <span class="s1">'loggedout/loggedin'</span>
    <span class="p">},</span>
    <span class="p">...</span>
<span class="p">]</span>
</code></pre>

<h1 id="events">/events</h1>

<h2 id="get-events-user-user-amp-type-type-amp-ampn-n-amp-task-task_id">GET /events?user=user&amp;type=type&amp;ampn=N&amp;task=task_id</h2>
<pre class="highlight javascript"><code><span class="p">[</span>
    <span class="p">{</span>
        <span class="na">user</span><span class="p">:</span> <span class="s1">'user@email.com'</span><span class="p">,</span>
        <span class="na">date</span><span class="p">:</span> <span class="nx">date</span><span class="p">,</span>
        <span class="na">action</span><span class="p">:</span> <span class="s1">'action string'</span><span class="p">,</span>
        <span class="na">task_id</span><span class="p">:</span> <span class="nx">task_id</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre>

<p>Returns not more than N events in chronological order with event type=type for user=user or for task=task_id.
If user is set than task is ignored.<br/>
Event type must be one of the following string:</p>

<ul>
<li>loginout</li>
<li>add</li>
<li>update</li>
<li>peek</li>
<li>suspend</li>
<li>activate</li>
<li>release</li>
<li>complete-success</li>
<li>complete-failure</li>
<li>grab</li>
<li>delete</li>
<li>login</li>
<li>logout</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
